@model KutuphaneMVC.Models.User
@{
    ViewData["Title"] = "KullanÄ±cÄ± DÃ¼zenle";
}

<h2 class="mb-4 fw-bold text-primary">âœï¸ KullanÄ±cÄ± DÃ¼zenle: @Model.Username</h2>

<div class="card">
    <div class="card-body">
        @if (ViewBag.Error != null)
        {
            <div class="alert alert-danger">@ViewBag.Error</div>
        }

        <form asp-action="Edit" asp-route-id="@Model.UserId" method="post">
            @Html.AntiForgeryToken()

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">KullanÄ±cÄ± AdÄ±</label>
                    <input type="text" class="form-control" value="@Model.Username" disabled />
                    <small class="text-muted">KullanÄ±cÄ± adÄ± deÄŸiÅŸtirilemez</small>
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label">Rol</label>
                    <input type="text" class="form-control" value="@Model.Role.ToString()" disabled />
                    <small class="text-muted">Rol deÄŸiÅŸtirilemez</small>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                    <input type="email" class="form-control" id="email" name="email" value="@Model.Email" required />
                </div>

                <div class="col-md-6 mb-3">
                    <label for="isActive" class="form-label">Durum <span class="text-danger">*</span></label>
                    <select class="form-select" id="isActive" name="isActive">
                        <option value="true" selected="@Model.IsActive">âœ… Aktif</option>
                        <option value="false" selected="@(!Model.IsActive)">âŒ Pasif</option>
                    </select>
                </div>
            </div>

            @if (Model.Member != null)
            {
                <hr />
                <h5 class="mb-3">Ãœye Bilgileri</h5>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="fullName" class="form-label">Ad Soyad</label>
                        <input type="text" class="form-control" id="fullName" name="fullName" value="@Model.Member.FullName" />
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="phone" class="form-label">Telefon</label>
                        <input type="text" class="form-control" id="phone" name="phone" value="@Model.Member.Phone" />
                    </div>
                </div>
            }

            <hr />
            <h5 class="mb-3">Åifre SÄ±fÄ±rlama</h5>
            <div class="row">
                <div class="col-md-12 mb-3">
                    <label class="form-label">Yeni Åifre (BoÅŸ bÄ±rakÄ±lÄ±rsa ÅŸifre deÄŸiÅŸmez)</label>
                    <div class="input-group">
                        <input type="password" class="form-control" id="newPassword" placeholder="Yeni ÅŸifre giriniz..." />
                        <button type="button" class="btn btn-warning" onclick="resetPassword()">
                            ğŸ”‘ Åifreyi SÄ±fÄ±rla
                        </button>
                    </div>
                    <small class="text-muted">En az 8 karakter</small>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">KayÄ±t Bilgileri</label>
                <p class="text-muted mb-0">
                    <strong>KayÄ±t Tarihi:</strong> @Model.CreatedDate.ToString("dd.MM.yyyy HH:mm")<br />
                    @if (Model.LastLoginDate.HasValue)
                    {
                        <strong>Son GiriÅŸ:</strong> @Model.LastLoginDate.Value.ToString("dd.MM.yyyy HH:mm")
                    }
                    else
                    {
                        <strong>Son GiriÅŸ:</strong> <span>HiÃ§ giriÅŸ yapmadÄ±</span>
                    }
                </p>
            </div>

            <div class="d-flex justify-content-between mt-4">
                <a asp-action="Index" class="btn btn-secondary">â¬… Geri DÃ¶n</a>
                <button type="submit" class="btn btn-success">âœ… Kaydet</button>
            </div>
        </form>
    </div>
</div>

<script>
    function resetPassword() {
        const newPassword = document.getElementById('newPassword').value;
        
        if (!newPassword || newPassword.length < 8) {
            alert('Åifre en az 8 karakter olmalÄ±dÄ±r!');
            return;
        }
        
        if (!confirm('KullanÄ±cÄ±nÄ±n ÅŸifresini sÄ±fÄ±rlamak istediÄŸinizden emin misiniz?')) {
            return;
        }
        
        // Form oluÅŸtur ve gÃ¶nder
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '@Url.Action("ResetPassword", "UserManagement", new { id = Model.UserId })';
        
        const csrfToken = document.querySelector('input[name="__RequestVerificationToken"]').value;
        const tokenInput = document.createElement('input');
        tokenInput.type = 'hidden';
        tokenInput.name = '__RequestVerificationToken';
        tokenInput.value = csrfToken;
        form.appendChild(tokenInput);
        
        const passwordInput = document.createElement('input');
        passwordInput.type = 'hidden';
        passwordInput.name = 'newPassword';
        passwordInput.value = newPassword;
        form.appendChild(passwordInput);
        
        document.body.appendChild(form);
        form.submit();
    }
</script>
