@model List<KutuphaneMVC.Models.Loan>
@{
    ViewData["Title"] = "Ã–dÃ¼nclerim";
}

<h2 class="mb-4 fw-bold text-primary">ğŸ“¦ Ã–dÃ¼nclerim</h2>

<p class="mb-4">AldÄ±ÄŸÄ±nÄ±z tÃ¼m kitaplarÄ± ve iade durumlarÄ±nÄ± gÃ¶rÃ¼ntÃ¼leyebilirsiniz.</p>

@if (Model.Any())
{
    var activeLoans = Model.Where(l => l.ReturnDate == null).ToList();
    
    <!-- Aktif Ã–dÃ¼nÃ§ler -->
    @if (activeLoans.Any())
    {
        <h4 class="mb-3 fw-bold text-warning">ğŸ”– Aktif Ã–dÃ¼nÃ§ler</h4>
        <div class="table-responsive mb-5">
            <table class="table table-hover">
                <thead class="table-warning">
                    <tr>
                        <th>Kitap</th>
                        <th>Alma Tarihi</th>
                        <th>Ä°ade Tarihi</th>
                        <th>Durum</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var loan in activeLoans)
                    {
                        var daysLeft = (loan.DueDate - DateTime.Now).Days;
                        var statusClass = daysLeft < 0 ? "danger" : daysLeft <= 3 ? "warning" : "success";
                        
                        <tr>
                            <td>
                                <strong>@loan.Book?.Title</strong><br />
                                <small class="text-muted">@loan.Book?.Author</small>
                            </td>
                            <td>@loan.BorrowDate.ToShortDateString()</td>
                            <td>@loan.DueDate.ToShortDateString()</td>
                            <td>
                                <span class="badge bg-@statusClass">
                                    @if (daysLeft < 0)
                                    {
                                        <text>âš ï¸ @Math.Abs(daysLeft) gÃ¼n gecikti</text>
                                    }
                                    else if (daysLeft <= 3)
                                    {
                                        <text>â° @daysLeft gÃ¼n kaldÄ±</text>
                                    }
                                    else
                                    {
                                        <text>âœ… @daysLeft gÃ¼n kaldÄ±</text>
                                    }
                                </span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }

    var returnedLoans = Model.Where(l => l.ReturnDate != null).ToList();
    
    <!-- Ä°ade Edilenler -->
    @if (returnedLoans.Any())
    {
        <h4 class="mb-3 fw-bold text-success">âœ… Ä°ade Edilenler</h4>
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-success">
                    <tr>
                        <th>Kitap</th>
                        <th>Alma Tarihi</th>
                        <th>Ä°ade Edilmesi Gereken</th>
                        <th>Ä°ade Tarihi</th>
                        <th>Durum</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var loan in returnedLoans)
                    {
                        var isLate = loan.ReturnDate > loan.DueDate;
                        var daysLate = isLate ? (loan.ReturnDate.Value - loan.DueDate).Days : 0;
                        
                        <tr>
                            <td>
                                <strong>@loan.Book?.Title</strong><br />
                                <small class="text-muted">@loan.Book?.Author</small>
                            </td>
                            <td>@loan.BorrowDate.ToShortDateString()</td>
                            <td>@loan.DueDate.ToShortDateString()</td>
                            <td>@loan.ReturnDate?.ToShortDateString()</td>
                            <td>
                                @if (isLate)
                                {
                                    <span class="badge bg-danger">âš ï¸ @daysLate gÃ¼n geÃ§ iade</span>
                                }
                                else
                                {
                                    <span class="badge bg-success">âœ… ZamanÄ±nda iade</span>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
}
else
{
    <div class="alert alert-info">
        <strong>ğŸ“¦ HenÃ¼z Ã¶dÃ¼nÃ§ aldÄ±ÄŸÄ±nÄ±z kitap bulunmamaktadÄ±r.</strong><br />
        Kitaplar sayfasÄ±ndan Ã¶dÃ¼nÃ§ isteÄŸi oluÅŸturabilirsiniz.
    </div>
    <a asp-controller="UserBook" asp-action="Index" class="btn btn-primary">
        ğŸ“š Kitaplara GÃ¶z At
    </a>
}
